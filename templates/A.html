<!DOCTYPE html>
<html lang="en">
  <head>
    <script type="text/javascript">
        var timerStart = Date.now();
        console.log('Page Load:' + timerStart)
        var uniq_session = timerStart;

        var cookie = getCookie('uid');
        var uniq_session = cookie;

        if (cookie == '' || cookie == null) {
          var uid = Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0, 12);
          console.log('uid:' + uid)
          setCookie('uid', uid,  40)
          cookie = getCookie('uid');
          uniq_session = cookie;
        }

        function setCookie(cname, cvalue, exdays) {
          var d = new Date();
          d.setTime(d.getTime() + (exdays*24*60*60*1000));
          var expires = "expires="+ d.toUTCString();
          document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        function getCookie(cname) {
          var name = cname + "=";
          var decodedCookie = decodeURIComponent(document.cookie);
          var ca = decodedCookie.split(';');
          for (var i = 0; i <ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') {
                  c = c.substring(1);
              }
              if (c.indexOf(name) == 0) {
                  return c.substring(name.length, c.length);
              }
          }
          return "";
        }

        console.log('version A: cookie:' + cookie)
    </script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- TODO: Feel free to modify anything inside main.css -->
    <link rel="stylesheet" href="../static/main.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">
    <title>CACT-US A</title>
  </head>

  <body>
    <header>
      <h1 class="text-center">CACT-I + CACT-YOU = CACT-US</h1>
      <!-- Ideas: making it pretty/look real, making it look reliable,
          choosing different images, changing layout, etc. Show your creativity!
          We want to see meaningful differences -->
      <!-- Feel free to beautify the site, and/or update the content-->
      <h5 class="text-center"><i>online live cacti store
        for your inner plant lady.</i>
      </h5>
    </header>


    

    <!-- If you add any new buttons, you need to update the javascript file, for
    corresponding button id, so that clicks of that button could be logged -->
    <div class="content-pane">
      <div class="card-deck">


        <div class="card" id="mp1">
          <img class="card-img-top" src="../static/coppercombo.png" alt="Card image cap">
          <div class="card-body d-flex flex-column">
            <h3 class="card-title text-center">Copper Combo</h3>
            <p class="card-text text-center">Stunning succulent combo, featuring 3 adolescent cacti in
              industrial copper pots.</p>
            <i class="h4 text-danger text-center">$9.99</i><br><br><br><br>
            <button class="mt-auto btn btn-lg btn-primary float-right" type="submit" id="mp1">
              Add To Cart
            </button>
            <div class="text-right"><span class="h4"><span class="h4 text-danger" id="mp1-added">0</span> in cart &nbsp;</span></div>
          </div>
        </div>


        <div class="card" id="mp2">
          <img class="card-img-top" src="../static/geoprickly.jpg" alt="Card image cap">
          <div class="card-body d-flex flex-column">
            <h3 class="card-title text-center">Geoprickly</h3>
            <p class="card-text text-center">Beautiful prickly pair in modern geometric pots.</p>
            <i class="h4 text-danger text-center">$14.99</i><br>
            <button class="mt-auto btn btn-lg btn-primary float-right" type="submit" id="mp2">
              Add To Cart
            </button>
            <div class="text-right"><span class="h4"><span class="h4 text-danger" id="mp2-added">0</span> in cart &nbsp;</span></div>
          </div>
        </div>

        <div class="card" id="mp3">
          <img class="card-img-top" src="../static/garden.jpg" alt="Card image cap">
          <div class="card-body d-flex flex-column">
            <h3 class="card-title text-center">Garden</h3>
            <p class="card-text text-center">Cacti and succulent mini-garden in a congenial and rustic pot.</p>
            <i class="h4 text-danger text-center">$25.99</i><br>
            <button class="mt-auto btn btn-lg btn-primary float-right" type="submit" id="mp3">
              Add To Cart
            </button>
            <div class="text-right"><span class="h4"><span class="h4 text-danger" id="mp3-added">0</span> in cart &nbsp;</span></div>
          </div>
        </div>


        <div class="card" id="mp4">
          <img class="card-img-top" src="../static/garden-combo.jpg" alt="Card image cap">
          <div class="card-body d-flex flex-column">
            <h3 class="card-title text-center">Garden Combo</h3>
            <p class="card-text text-center">Cacti, succulent, and garden combo in handcrafted pots.</p>
            <i class="h4 text-danger text-center">$34.99</i><br><br><br><br><br><br>
            <button class="mt-auto btn btn-lg btn-primary float-right" type="submit" id="mp4">
              Add To Cart
            </button>
            <div class="text-right"><span class="h4"><span class="h4 text-danger" id="mp4-added">0</span> in cart &nbsp;</span></div>
          </div>
        </div>

      </div>
    </div>
    <div id="cart-wrapper" class="d-flex justify-content-end mr-5">
      <a onclick='navigateToCheckout()'>
      <span id="cart" class="fa-stack fa-2x has-badge" data-count="0">
        <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
        <i class="fa fa-shopping-cart fa-stack-2x red-cart"></i><br>
      </span> 
      <h5 class="text-right text-primary"><u>Checkout</u></h5>
    </a>
    </div>
    <!-- <div class="content-pane">
      <div class="vendor-wrapper" id="mp1">
        <img src="../static/coppercombo.png" class="vendor-photo" />
        <h4>Stunning succulent combo, featuring 3 adolescent cacti in
          industrial copper pots. 
        </h4>
        <i class="h4 text-danger">$9.99</i><br>
        <button class="vendor-book-button btn btn-lg btn-primary" type="submit" id="mp1">
          <b class="h4">Add To Cart</b>
        </button><br>
        <span class="h4"><span class="h4 text-danger" id="mp1-added">0</span> in cart</span>
      </div>

      <div class="vendor-wrapper" id="mp2">
        <img src="../static/geoprickly.jpg" class="vendor-photo" />
        <h4>Beautiful prickly pair in modern geometric pots. 
        </h4>
        <i class="h4 text-danger">$14.99</i><br>
        <button class="vendor-book-button btn btn-lg btn-primary" type="submit" id="mp2">
          <b class="h4">Add To Cart</b>
        </button><br>
        <span class="h4"><span class="h4 text-danger" id="mp2-added">0</span> in cart</span>
      </div>

      <div class="vendor-wrapper" id="mp3">
        <img src="../static/garden.jpg" class="vendor-photo" />
        <h4>Cacti and succulent mini-garden in a congenial and rustic pot. 
        </h4>
        <i class="h4 text-danger">$25.99</i><br>
        <button class="vendor-book-button btn btn-lg btn-primary" type="submit" id="mp3">
          <b class="h4">Add To Cart</b>
        </button><br>
        <span class="h4"><span class="h4 text-danger" id="mp3-added">0</span> in cart</span>
      </div>

      <div class="vendor-wrapper" id="mp4">
        <img src="../static/garden-combo.jpg" class="vendor-photo" />
        <h4>Cacti, succulent, and garden combo in handcrafted pots. 
        </h4>
        <i class="h4 text-danger">$34.99</i><br>
        <button class="vendor-book-button btn btn-lg btn-primary" type="submit" id="mp4">
          <b class="h4">Add To Cart</b>
        </button><br>
        <span class="h4"><span class="h4 text-danger" id="mp4-added">0</span> in cart</span>
      </div>
      
    </div> -->

    
    <!-- DO NOT EDIT below this line!! -->
    <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script>
        var timeLoaded = Date.now()
          $(document).ready(function() {
            timeLoaded =  Date.now();
            console.log('Page Load:' + timeLoaded)
            sendData(timeLoaded, 0.0, 0.0, uniq_session)

            // Update counts based on saved data in URL params.
            // If you add more cacti, you'll want to update this to include them here.
            if(window.location.href.includes('&')) {
              addToCart('mp1', /* num = */ int(getParameterByName('mp1')));
              addToCart('mp2', /* num = */ int(getParameterByName('mp2')));
              addToCart('mp3', /* num = */ int(getParameterByName('mp3')));
              addToCart('mp4', /* num = */ int(getParameterByName('mp4')));
            }
          });

        $("#mp1").on("click", function(d) {
              logClick('mp1')
              addToCart('mp1');
        })

        $("#mp2").on("click", function(d) {
              logClick('mp2')
              addToCart('mp2');
        })

        $("#mp3").on("click", function(d) {
              logClick('mp3')
              addToCart('mp3');
        })

        $("#mp4").on("click", function(d) {
              logClick('mp4')
              addToCart('mp4');
        })

        function logClick(clickObjectID) {
          var clickTime = Date.now()
          console.log('Click Time:' + clickTime)
          sendData(timeLoaded, clickTime, clickObjectID, uniq_session)
        }

        // Adds item with given id to the cart.
        function addToCart(item, num = 1) {
          countId = item + "-added";
          document.getElementById(countId).textContent = parseInt(document.getElementById(countId).textContent, 0) + num;
          incrementCartCount(val = num);
        }

        // Helper function for adding an item to the cart. Logically and visually increments the cart count.
        function incrementCartCount(val = 1) {
          var cartCount = parseInt(document.getElementById("cart")
                                            .getAttribute('data-count')) + val;
          document.getElementById("cart").setAttribute('data-count', cartCount.toString())
        }

        function int(str) {
            return parseInt(str, 0);
        }

        function navigateToCheckout() {
          // Send number of items in cart to checkout page through URL params.
          params = 'version=A';
          Array.from(document.getElementsByClassName('vendor-wrapper')).forEach(el => {
            numInCart = parseInt(document.getElementById(el.id + '-added').textContent, 0);
            params += ('&' + el.id + '=' + numInCart)
          })
          window.location.href = '/checkout?' + params;
        }

        function sendData(timeLoaded, clickTime, clickObjectID, cook){
              var dataObj = { 'version': 'A', 'pageLoadTime': timeLoaded ,
              'clickTime': clickTime , 'HtmlElementID': clickObjectID,
              'UniqueSession' :uniq_session};
              console.log(JSON.stringify(dataObj))
               $.ajax({
                   type: 'POST',
                    url: '/data',
                    async: false,
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(dataObj),
                    success: function(callback) {
                        console.log(callback);
                    },
                    error: function() {
                        $(this).html("error!");
                    }
              });
        }

        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }
     </script>
  </body>
</html>
